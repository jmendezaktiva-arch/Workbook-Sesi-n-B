<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workbook Interactivo 2.2 - Sesión B</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
        }
        .brand-blue { color: #00529B; }
        .brand-orange { color: #F68D2E; }
        .bg-brand-blue { background-color: #00529B; }
        .bg-brand-orange { background-color: #F68D2E; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #00529B; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #003f7a; }

        .section-content {
            display: none;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }
        .section-content.active {
            display: block;
            opacity: 1;
        }
        .nav-link.active {
            background-color: #eef2ff;
            color: #00529B;
            font-weight: 700;
        }
        .completion-icon {
            transition: all 0.3s ease;
        }
        
        /* ESTILOS INTEGRADOs PARA EL EJERCICIO 1 MEJORADO */
        .instructions-box {
            background-color: #eff6ff;
            border-left: 4px solid #00529B;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .question-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .question-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            flex-wrap: wrap;
        }
        .question-text-container {
            flex-grow: 1;
            margin-right: 1rem;
            min-width: 250px;
        }
        .question-text {
            font-weight: 600;
            color: #374151;
        }
        .question-helper-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .toggle-switch {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        .toggle-switch input[type="radio"] {
            display: none;
        }
        .toggle-switch label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            font-weight: 600;
        }
        .toggle-switch input[type="radio"]:checked + label {
            background-color: #00529B;
            color: white;
        }
        .toggle-switch input[type="radio"]:not(:checked) + label {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .satisfaction-scale {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .satisfaction-scale input[type="radio"] {
            display: none;
        }
        .satisfaction-scale label {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
        }
        .satisfaction-scale input[type="radio"]:checked + label {
            background-color: #00529B;
            color: white;
            border-color: #00529B;
            transform: scale(1.1);
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Menú Lateral -->
        <aside class="w-full md:w-80 bg-white shadow-lg p-6 sticky top-0 h-screen overflow-y-auto flex flex-col">
            <div class="flex items-center justify-center mb-6">
                <img src="https://placehold.co/250x100/FFFFFF/00529B?text=Mi+Empresa\nCrece&font=montserrat" alt="Logo Mi Empresa Crece" class="h-20">
            </div>
            
            <div class="mb-6">
                <h4 class="text-sm font-bold text-gray-600 mb-2">Progreso Sesión B</h4>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-brand-blue h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <nav id="nav-menu" class="flex-grow">
                <ul class="space-y-2">
                    <!-- Links de navegación generados por JS -->
                </ul>
            </nav>
            <div class="mt-auto pt-6">
                <button id="export-pdf" class="w-full flex items-center justify-center gap-2 bg-brand-blue text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" /></svg>
                    Exportar a PDF
                </button>
            </div>
             <div id="loading" class="mt-4 text-center" style="display: none;">
                <p class="text-brand-blue animate-pulse">Generando PDF, por favor espera...</p>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main id="main-content" class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header class="bg-white shadow-md rounded-xl p-6 mb-8">
                <h1 class="text-4xl font-black brand-blue">Workbook Interactivo 2.2</h1>
                <p class="text-lg text-gray-600 mt-2">Sesión B: Impulsa tu PyME: Ecosistema Digital de Ventas</p>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" placeholder="Nombre del participante" class="autosave-input p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-orange focus:border-transparent transition" data-id="sesionb_nombre_participante">
                    <input type="text" placeholder="Empresa" class="autosave-input p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-orange focus:border-transparent transition" data-id="sesionb_nombre_empresa">
                </div>
            </header>

            <!-- Secciones generadas por JS -->

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mainContent = document.getElementById('main-content');
            const navMenu = document.getElementById('nav-menu').querySelector('ul');
            
            // --- CONFIGURACIÓN DE SECCIONES ---
            const sectionsData = [
                { id: 'foco', title: '1. Diagnóstico 360°', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>` },
                { id: 'persona', title: '2. Ficha de Cliente Ideal', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>` },
                { id: 'auditoria', title: '3. Auditoría de Activos', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>` },
                { id: 'matriz', title: '4. Matriz de Priorización', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>` },
                { id: 'plan', title: '5. Plan Maestro de Canal', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>` },
                { id: 'flujo', title: '6. Diseñador de Flujos', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12s2.545-5 7-5c4.455 0 7 5 7 5s-2.545 5-7 5c-4.455 0-7-5-7-5z"></path><path d="M12 13a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path><path d="M20.599 16.5h-1.2a2 2 0 0 0-1.923 1.423l-.485 1.14a1 1 0 0 1-1.838-.78l.485-1.14a2 2 0 0 0-1.923-1.423h-1.2a2 2 0 0 0-1.923 1.423l-.485 1.14a1 1 0 0 1-1.838-.78l.485-1.14a2 2 0 0 0-1.923-1.423H4.4a1 1 0 0 1 0-2h1.199a2 2 0 0 0 1.923-1.423l.485-1.14a1 1 0 0 1 1.838.78l-.485 1.14a2 2 0 0 0 1.923 1.423h1.2a2 2 0 0 0 1.923-1.423l.485-1.14a1 1 0 0 1 1.838.78l-.485 1.14a2 2 0 0 0 1.923 1.423h1.2a1 1 0 0 1 0 2z"></path></svg>` },
                { id: 'sprint', title: '7. Sprint de Implementación', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>` },
            ];

            // --- GENERACIÓN DINÁMICA DE CONTENIDO ---
            sectionsData.forEach(data => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <a href="#${data.id}" class="nav-link flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-brand-blue transition-colors duration-300">
                        <span class="completion-icon text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </span>
                        ${data.icon}
                        <span class="flex-grow">${data.title}</span>
                    </a>`;
                navMenu.appendChild(li);

                const section = document.createElement('section');
                section.id = data.id;
                section.className = 'section-content bg-white shadow-xl rounded-2xl p-8 mb-8';
                mainContent.appendChild(section);
            });
            
            // --- INYECTAR CONTENIDO HTML EN SECCIONES ---
            
            // EJERCICIO 1 - VERSIÓN 2.2 INTEGRADA
            document.getElementById('foco').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                    ${sectionsData[0].title}
                </h2>

                <div class="instructions-box">
                    <p><strong>Objetivo:</strong> Realizar un <strong>diagnóstico 360°</strong> para medir el nivel de madurez real de tu ecosistema digital, desde la posesión de activos básicos hasta la rentabilidad de tus acciones, con el fin de identificar y priorizar los problemas de mayor impacto en tu negocio.</p>
                </div>

                <div class="space-y-8">
                    <h3 class="section-title">Apartado A: Auditoría de Presencia Digital</h3>
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <div class="question-list">
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Tienes comprado el dominio web de tu empresa?</p></div><div class="toggle-switch"><input type="radio" id="foco_dominio_si" name="dominio" value="si" class="autosave-input" data-section="foco" data-id="foco_dominio"><label for="foco_dominio_si">Sí</label><input type="radio" id="foco_dominio_no" name="dominio" value="no" class="autosave-input" data-section="foco" data-id="foco_dominio"><label for="foco_dominio_no">No</label></div></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Cuentas con una página web vigente?</p></div><div class="toggle-switch"><input type="radio" id="foco_web_si" name="web" value="si" class="autosave-input" data-section="foco" data-id="foco_web"><label for="foco_web_si">Sí</label><input type="radio" id="foco_web_no" name="web" value="no" class="autosave-input" data-section="foco" data-id="foco_web"><label for="foco_web_no">No</label></div></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Tienes Landing Page o un flujo de contacto diseñado?</p><p class="question-helper-text">Una página específica para que te compren o contacten.</p></div><div class="toggle-switch"><input type="radio" id="foco_landing_si" name="landing" value="si" class="autosave-input" data-section="foco" data-id="foco_landing"><label for="foco_landing_si">Sí</label><input type="radio" id="foco_landing_no" name="landing" value="no" class="autosave-input" data-section="foco" data-id="foco_landing"><label for="foco_landing_no">No</label></div></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Mantienes al menos una publicación mensual en redes activas?</p></div><div class="toggle-switch"><input type="radio" id="foco_publicacion_si" name="publicacion" value="si" class="autosave-input" data-section="foco" data-id="foco_publicacion"><label for="foco_publicacion_si">Sí</label><input type="radio" id="foco_publicacion_no" name="publicacion" value="no" class="autosave-input" data-section="foco" data-id="foco_publicacion"><label for="foco_publicacion_no">No</label></div></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <p class="font-bold text-gray-700 mb-4">¿Tienes cuentas registradas para "apartar" el nombre de tu marca en redes sociales?</p>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_facebook"> Facebook</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_instagram"> Instagram</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_tiktok"> TikTok</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_whatsapp"> WhatsApp</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_youtube"> YouTube</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_google"> Google</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_twitter"> Twitter / X</label>
                            <label class="flex items-center gap-2"><input type="checkbox" class="autosave-input h-5 w-5 rounded text-brand-blue focus:ring-brand-blue" data-section="foco" data-id="foco_red_linkedin"> LinkedIn</label>
                        </div>
                    </div>

                    <h3 class="section-title pt-8">Apartado B: Diagnóstico de Madurez y Rendimiento</h3>
                    
                    <div class="overflow-x-auto bg-white p-6 rounded-lg shadow-sm border">
                        <p class="font-bold text-gray-700 mb-4">Mapa de Ecosistema Digital: Evalúa tu nivel actual en cada categoría.</p>
                        <table class="w-full min-w-[600px] text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3">Categoría</th>
                                    <th class="px-6 py-3 text-center">0 - Inexistente</th>
                                    <th class="px-6 py-3 text-center">1 - Básico</th>
                                    <th class="px-6 py-3 text-center">2 - Estructurado</th>
                                    <th class="px-6 py-3 text-center">3 - Optimizado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b"><td class="px-6 py-4 font-medium text-gray-900">Presencia Orgánica</td><td class="px-6 py-4 text-center"><input type="radio" name="cat1" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat1" value="0"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat1" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat1" value="1"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat1" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat1" value="2"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat1" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat1" value="3"></td></tr>
                                <tr class="border-b"><td class="px-6 py-4 font-medium text-gray-900">SEO & Contenido</td><td class="px-6 py-4 text-center"><input type="radio" name="cat2" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat2" value="0"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat2" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat2" value="1"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat2" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat2" value="2"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat2" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat2" value="3"></td></tr>
                                <tr class="border-b"><td class="px-6 py-4 font-medium text-gray-900">Captación Pagada (Ads)</td><td class="px-6 py-4 text-center"><input type="radio" name="cat3" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat3" value="0"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat3" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat3" value="1"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat3" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat3" value="2"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat3" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat3" value="3"></td></tr>
                                <tr class="border-b"><td class="px-6 py-4 font-medium text-gray-900">Automatización</td><td class="px-6 py-4 text-center"><input type="radio" name="cat4" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat4" value="0"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat4" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat4" value="1"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat4" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat4" value="2"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat4" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat4" value="3"></td></tr>
                                <tr class="border-b"><td class="px-6 py-4 font-medium text-gray-900">Comunidad</td><td class="px-6 py-4 text-center"><input type="radio" name="cat5" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat5" value="0"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat5" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat5" value="1"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat5" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat5" value="2"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat5" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat5" value="3"></td></tr>
                                <tr class="border-b"><td class="px-6 py-4 font-medium text-gray-900">Prospección Manual</td><td class="px-6 py-4 text-center"><input type="radio" name="cat6" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat6" value="0"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat6" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat6" value="1"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat6" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat6" value="2"></td><td class="px-6 py-4 text-center"><input type="radio" name="cat6" class="autosave-input form-radio h-5 w-5 text-brand-blue" data-section="foco" data-id="foco_cat6" value="3"></td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border mt-8">
                        <div class="question-list">
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Generas ventas digitales (trimestral B2B / mensual B2C)?</p></div><div class="toggle-switch"><input type="radio" id="foco_ventas_si" name="ventas" value="si" class="autosave-input" data-section="foco" data-id="foco_ventas"><label for="foco_ventas_si">Sí</label><input type="radio" id="foco_ventas_no" name="ventas" value="no" class="autosave-input" data-section="foco" data-id="foco_ventas"><label for="foco_ventas_no">No</label></div></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Tienes una meta de ventas o prospectos por canal?</p></div><div class="toggle-switch"><input type="radio" id="foco_meta_si" name="meta" value="si" class="autosave-input" data-section="foco" data-id="foco_meta"><label for="foco_meta_si">Sí</label><input type="radio" id="foco_meta_no" name="meta" value="no" class="autosave-input" data-section="foco" data-id="foco_meta"><label for="foco_meta_no">No</label></div></div>
                            <div class="question-row flex-col items-start"><label for="foco_meta_cumplimiento" class="question-text mb-2">En los últimos 6 meses, ¿cuántas veces se cumplió tu meta?</label><input type="text" id="foco_meta_cumplimiento" class="autosave-input w-full p-3 border border-gray-300 rounded-lg" data-section="foco" data-id="foco_meta_cumplimiento"></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Conoces el costo por venta o prospecto?</p></div><div class="toggle-switch"><input type="radio" id="foco_costo_si" name="costo" value="si" class="autosave-input" data-section="foco" data-id="foco_costo"><label for="foco_costo_si">Sí</label><input type="radio" id="foco_costo_no" name="costo" value="no" class="autosave-input" data-section="foco" data-id="foco_costo"><label for="foco_costo_no">No</label></div></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Sabes cuánto inviertes en tu estrategia digital total?</p><p class="question-helper-text">Incluye mano de obra, plataformas y pauta.</p></div><div class="toggle-switch"><input type="radio" id="foco_inversion_si" name="inversion" value="si" class="autosave-input" data-section="foco" data-id="foco_inversion"><label for="foco_inversion_si">Sí</label><input type="radio" id="foco_inversion_no" name="inversion" value="no" class="autosave-input" data-section="foco" data-id="foco_inversion"><label for="foco_inversion_no">No</label></div></div>
                            <div class="question-row"><div class="question-text-container"><p class="question-text">¿Sabes el Retorno de Inversión (ROI) que te da?</p><p class="question-helper-text">Cuántos pesos genera de vuelta cada peso invertido.</p></div><div class="toggle-switch"><input type="radio" id="foco_roi_si" name="roi" value="si" class="autosave-input" data-section="foco" data-id="foco_roi"><label for="foco_roi_si">Sí</label><input type="radio" id="foco_roi_no" name="roi" value="no" class="autosave-input" data-section="foco" data-id="foco_roi"><label for="foco_roi_no">No</label></div></div>
                        </div>
                    </div>

                    <h3 class="section-title pt-8">Apartado C: Síntesis y Foco Estratégico</h3>

                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <p class="font-bold text-gray-700 mb-4 text-center">Del 1 al 10, ¿qué tan satisfecho te sientes con la madurez de tu Ecosistema de ventas digital?</p>
                        <div class="satisfaction-scale">
                            <input type="radio" id="foco_sat_1" name="satisfaccion" value="1" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_1">1</label>
                            <input type="radio" id="foco_sat_2" name="satisfaccion" value="2" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_2">2</label>
                            <input type="radio" id="foco_sat_3" name="satisfaccion" value="3" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_3">3</label>
                            <input type="radio" id="foco_sat_4" name="satisfaccion" value="4" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_4">4</label>
                            <input type="radio" id="foco_sat_5" name="satisfaccion" value="5" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_5">5</label>
                            <input type="radio" id="foco_sat_6" name="satisfaccion" value="6" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_6">6</label>
                            <input type="radio" id="foco_sat_7" name="satisfaccion" value="7" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_7">7</label>
                            <input type="radio" id="foco_sat_8" name="satisfaccion" value="8" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_8">8</label>
                            <input type="radio" id="foco_sat_9" name="satisfaccion" value="9" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_9">9</label>
                            <input type="radio" id="foco_sat_10" name="satisfaccion" value="10" class="autosave-input" data-section="foco" data-id="foco_satisfaccion"><label for="foco_sat_10">10</label>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border mt-8">
                        <label for="foco_problemas" class="font-bold text-gray-700 mb-2 block">Basado en todo lo anterior, ¿cuáles crees que son tus 3 principales problemas a resolver?</label>
                        <textarea id="foco_problemas" rows="4" class="autosave-input w-full p-3 border border-gray-300 rounded-lg" data-section="foco" data-id="foco_problemas"></textarea>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border mt-8">
                        <label for="foco_prioritario" class="font-bold text-gray-700 mb-2 block">De estos problemas, ¿cuál consideras que es el más prioritario?</label>
                        <textarea id="foco_prioritario" rows="4" class="autosave-input w-full p-3 border border-gray-300 rounded-lg" data-section="foco" data-id="foco_prioritario"></textarea>
                    </div>
                </div>
            `;

            document.getElementById('persona').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">${sectionsData[1].icon} ${sectionsData[1].title.substring(3)}</h2>
                <div class="instructions-box">
                    <p><strong>Objetivo:</strong> Crear un arquetipo detallado del cliente ideal que sirva como brújula para todas las decisiones de marketing.</p>
                    <p class="mt-2 italic">"Liderazgo es empatía. No puedes guiar a alguien a una solución si no entiendes su viaje. Usa esta ficha para caminar en los zapatos de tu cliente."</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 p-4 rounded-lg border"><h3 class="font-bold text-lg mb-2 text-gray-800">Sección 1: El Retrato</h3><p class="text-sm text-gray-500 mb-3">Datos Demográficos y Laborales</p><textarea class="autosave-input w-full p-2 border border-gray-300 rounded-md h-24" placeholder="Nombre, Edad, Cargo, Sector..." data-section="persona" data-id="persona_retrato"></textarea></div>
                    <div class="bg-gray-50 p-4 rounded-lg border"><h3 class="font-bold text-lg mb-2 text-gray-800">Sección 2: La Mente</h3><p class="text-sm text-gray-500 mb-3">Metas y Desafíos</p><textarea class="autosave-input w-full p-2 border border-gray-300 rounded-md h-24" placeholder="¿Qué busca lograr? ¿Qué le impide dormir por la noche?" data-section="persona" data-id="persona_mente"></textarea></div>
                    <div class="bg-gray-50 p-4 rounded-lg border"><h3 class="font-bold text-lg mb-2 text-gray-800">Sección 3: El Corazón</h3><p class="text-sm text-gray-500 mb-3">Objeciones y Motivaciones</p><textarea class="autosave-input w-full p-2 border border-gray-300 rounded-md h-24" placeholder="¿Qué le haría dudar? ¿Qué resultado sueña obtener?" data-section="persona" data-id="persona_corazon"></textarea></div>
                    <div class="bg-gray-50 p-4 rounded-lg border"><h3 class="font-bold text-lg mb-2 text-gray-800">Sección 4: El Hábitat Digital</h3><p class="text-sm text-gray-500 mb-3">Plataformas y Contenidos</p><textarea class="autosave-input w-full p-2 border border-gray-300 rounded-md h-24" placeholder="¿Qué 3 redes sociales usa? ¿Qué tipo de contenido consume?" data-section="persona" data-id="persona_habitat"></textarea></div>
                </div>`;
            
            document.getElementById('auditoria').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">${sectionsData[2].icon} ${sectionsData[2].title.substring(3)}</h2>
                <div class="instructions-box">
                    <p><strong>Objetivo:</strong> Convertir conceptos de "buena presencia" en una lista de tareas concretas, priorizadas y con responsables.</p>
                    <p class="mt-2 italic">"Disciplina es convertir las buenas intenciones en acciones agendadas. Una tarea sin responsable ni fecha es solo un deseo."</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full min-w-[800px] text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr><th class="px-4 py-3">Punto de Verificación</th><th class="px-4 py-3">Estado (R/A/V)</th><th class="px-4 py-3">Acción de Mejora Específica</th><th class="px-4 py-3">Responsable y Fecha Límite</th></tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="px-4 py-2 font-medium">CTA claro y visible en Home</td>
                                <td class="px-4 py-2"><select class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_cta_status"><option value="status-rojo">Rojo</option><option value="status-amarillo">Amarillo</option><option value="status-verde">Verde</option></select></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_cta_accion"></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_cta_responsable"></td>
                            </tr>
                            <tr class="border-b">
                                <td class="px-4 py-2 font-medium">Velocidad de carga en móvil (< 3s)</td>
                                <td class="px-4 py-2"><select class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_velocidad_status"><option value="status-rojo">Rojo</option><option value="status-amarillo">Amarillo</option><option value="status-verde">Verde</option></select></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_velocidad_accion"></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_velocidad_responsable"></td>
                            </tr>
                            <tr class="border-b">
                                <td class="px-4 py-2 font-medium">Prueba social presente (testimonios/logos)</td>
                                <td class="px-4 py-2"><select class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_prueba_status"><option value="status-rojo">Rojo</option><option value="status-amarillo">Amarillo</option><option value="status-verde">Verde</option></select></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_prueba_accion"></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_prueba_responsable"></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-medium">Información de contacto fácil de encontrar</td>
                                <td class="px-4 py-2"><select class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_contacto_status"><option value="status-rojo">Rojo</option><option value="status-amarillo">Amarillo</option><option value="status-verde">Verde</option></select></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_contacto_accion"></td>
                                <td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="auditoria" data-id="auditoria_contacto_responsable"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>`;

            document.getElementById('matriz').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">${sectionsData[3].icon} ${sectionsData[3].title.substring(3)}</h2>
                <div class="instructions-box">
                    <p><strong>Objetivo:</strong> Facilitar una decisión estratégica y visual sobre dónde invertir recursos, utilizando un modelo mental probado.</p>
                </div>
                <div class="flex items-center justify-center">
                    <div class="grid grid-cols-2 grid-rows-2 w-full max-w-3xl aspect-square relative">
                        <div class="absolute -left-20 top-1/2 -translate-y-1/2 -rotate-90 font-bold text-gray-600">Impacto Potencial</div>
                        <div class="absolute -bottom-12 left-1/2 -translate-x-1/2 font-bold text-gray-600">Facilidad de Implementación</div>
                        <div class="border-2 border-dashed border-gray-400 p-4 flex flex-col"><h4 class="font-bold text-lg text-red-600">Proyectos Estratégicos</h4><p class="text-sm text-gray-500 mb-2">(Alto Impacto, Baja Facilidad)</p><textarea placeholder="PLANIFICAR..." class="autosave-input w-full h-full bg-transparent border-0 p-1 focus:ring-0" data-section="matriz" data-id="matriz_q2"></textarea></div>
                        <div class="border-2 border-dashed border-gray-400 p-4 flex flex-col bg-green-50"><h4 class="font-bold text-lg text-green-700">Joyas de la Corona</h4><p class="text-sm text-gray-500 mb-2">(Alto Impacto, Alta Facilidad)</p><textarea placeholder="ACCIÓN INMEDIATA..." class="autosave-input w-full h-full bg-transparent border-0 p-1 focus:ring-0" data-section="matriz" data-id="matriz_q1"></textarea></div>
                        <div class="border-2 border-dashed border-gray-400 p-4 flex flex-col"><h4 class="font-bold text-lg text-gray-700">Zonas Peligrosas</h4><p class="text-sm text-gray-500 mb-2">(Bajo Impacto, Baja Facilidad)</p><textarea placeholder="EVITAR POR AHORA..." class="autosave-input w-full h-full bg-transparent border-0 p-1 focus:ring-0" data-section="matriz" data-id="matriz_q4"></textarea></div>
                        <div class="border-2 border-dashed border-gray-400 p-4 flex flex-col bg-yellow-50"><h4 class="font-bold text-lg text-yellow-700">Victorias Fáciles</h4><p class="text-sm text-gray-500 mb-2">(Bajo Impacto, Alta Facilidad)</p><textarea placeholder="DELEGAR O AUTOMATIZAR..." class="autosave-input w-full h-full bg-transparent border-0 p-1 focus:ring-0" data-section="matriz" data-id="matriz_q3"></textarea></div>
                    </div>
                </div>`;

            document.getElementById('plan').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">${sectionsData[4].icon} ${sectionsData[4].title.substring(3)}</h2>
                <div class="instructions-box">
                    <p><strong>Objetivo:</strong> Crear un plan estratégico de una página para cada canal prioritario.</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg border space-y-4">
                    <div><label class="block text-md font-medium text-gray-700">Rol Estratégico del Canal (Marcar uno):</label><div class="flex flex-wrap gap-4 mt-2"><label class="flex items-center"><input type="radio" name="rol" class="autosave-input form-radio" value="leads" data-section="plan" data-id="plan_rol"> Generación de Leads</label><label class="flex items-center"><input type="radio" name="rol" class="autosave-input form-radio" value="comunidad" data-section="plan" data-id="plan_rol"> Construcción de Comunidad</label><label class="flex items-center"><input type="radio" name="rol" class="autosave-input form-radio" value="ventas" data-section="plan" data-id="plan_rol"> Ventas Directas</label><label class="flex items-center"><input type="radio" name="rol" class="autosave-input form-radio" value="marca" data-section="plan" data-id="plan_rol"> Autoridad de Marca</label></div></div>
                    <div><label class="block text-md font-medium text-gray-700">Métrica Clave de Éxito (KPI):</label><input type="text" placeholder="Ej: Nº de mensajes pidiendo cotización" class="autosave-input w-full p-2 border rounded-md" data-section="plan" data-id="plan_kpi"></div>
                    <div><label class="block text-md font-medium text-gray-700">Propuesta de Valor para este Canal:</label><input type="text" placeholder="¿Por qué debería seguirte alguien aquí?" class="autosave-input w-full p-2 border rounded-md" data-section="plan" data-id="plan_propuesta"></div>
                    <div><label class="block text-md font-medium text-gray-700">Líneas de Contenido Principales (Definir 2-3 temas):</label><textarea rows="3" placeholder="1. Detrás de cámaras del proceso..." class="autosave-input w-full p-2 border rounded-md" data-section="plan" data-id="plan_contenido"></textarea></div>
                    <div><label class="block text-md font-medium text-gray-700">Idea para el Imán de Leads (Lead Magnet):</label><input type="text" placeholder="¿Qué recurso valioso ofrecerás para capturar datos?" class="autosave-input w-full p-2 border rounded-md" data-section="plan" data-id="plan_leadmagnet"></div>
                </div>`;

            document.getElementById('flujo').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">${sectionsData[5].icon} ${sectionsData[5].title.substring(3)}</h2>
                <div class="instructions-box">
                     <p><strong>Objetivo:</strong> Desmitificar la automatización, permitiendo diseñar visualmente tu primer embudo de conversión simple y efectivo.</p>
                </div>
                <div class="flex flex-col md:flex-row items-center justify-center gap-x-4 gap-y-8 text-center flex-wrap">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-300 w-full sm:w-5/12 lg:w-1/5"><h4 class="font-bold">1. Fuente de Tráfico</h4><textarea placeholder="¿Desde dónde llegará la gente?" class="autosave-input w-full mt-2 p-2 border rounded-md h-24" data-section="flujo" data-id="flujo_fuente"></textarea></div>
                    <div class="text-2xl font-bold text-blue-400 hidden lg:block">→</div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-300 w-full sm:w-5/12 lg:w-1/5"><h4 class="font-bold">2. La Oferta (Lead Magnet)</h4><textarea placeholder="Mi Lead Magnet es..." class="autosave-input w-full mt-2 p-2 border rounded-md h-24" data-section="flujo" data-id="flujo_oferta"></textarea></div>
                    <div class="text-2xl font-bold text-blue-400 hidden lg:block">→</div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-300 w-full sm:w-5/12 lg:w-1/5"><h4 class="font-bold">3. La Captura</h4><textarea placeholder="¿Qué datos pediré?" class="autosave-input w-full mt-2 p-2 border rounded-md h-24" data-section="flujo" data-id="flujo_captura"></textarea></div>
                    <div class="text-2xl font-bold text-blue-400 hidden lg:block">→</div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-300 w-full sm:w-5/12 lg:w-1/5"><h4 class="font-bold">4. Mensaje de Bienvenida</h4><textarea placeholder="Asunto y primeras líneas..." class="autosave-input w-full mt-2 p-2 border rounded-md h-24" data-section="flujo" data-id="flujo_mensaje"></textarea></div>
                </div>`;

            document.getElementById('sprint').innerHTML = `
                <h2 class="text-3xl font-bold brand-orange mb-4 flex items-center gap-3">${sectionsData[6].icon} ${sectionsData[6].title.substring(3)}</h2>
                <div class="instructions-box">
                    <p><strong>Objetivo:</strong> Transformar la estrategia en un calendario de ejecución concreto y medible.</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full min-w-[900px] text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr><th class="px-4 py-3">Semana</th><th class="px-4 py-3">Foco de la Semana</th><th class="px-4 py-3">Tareas Clave (3-5)</th><th class="px-4 py-3">Métrica de Enfoque</th><th class="px-4 py-3">Reflexión</th></tr>
                        </thead>
                        <tbody>
                            <tr class="border-b"><td class="px-4 py-2 font-bold">1</td><td class="px-4 py-2"><input type="text" placeholder="Ej: Lanzamiento" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w1_foco"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w1_tareas"></textarea></td><td class="px-4 py-2"><input type="text" placeholder="¿Qué número miraré?" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w1_metrica"></td><td class="px-4 py-2"><textarea rows="2" placeholder="¿Qué funcionó?" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w1_reflexion"></textarea></td></tr>
                            <tr class="border-b"><td class="px-4 py-2 font-bold">2</td><td class="px-4 py-2"><input type="text" placeholder="Ej: Optimización" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w2_foco"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w2_tareas"></textarea></td><td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w2_metrica"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w2_reflexion"></textarea></td></tr>
                            <tr class="border-b"><td class="px-4 py-2 font-bold">3</td><td class="px-4 py-2"><input type="text" placeholder="Ej: Escalamiento" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w3_foco"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w3_tareas"></textarea></td><td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w3_metrica"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w3_reflexion"></textarea></td></tr>
                            <tr><td class="px-4 py-2 font-bold">4</td><td class="px-4 py-2"><input type="text" placeholder="Ej: Revisión y Plan" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w4_foco"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w4_tareas"></textarea></td><td class="px-4 py-2"><input type="text" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w4_metrica"></td><td class="px-4 py-2"><textarea rows="2" class="autosave-input w-full p-2 border rounded-md" data-section="sprint" data-id="sprint_w4_reflexion"></textarea></td></tr>
                        </tbody>
                    </table>
                </div>`;

            // --- LÓGICA DE NAVEGACIÓN Y ESTADO ---
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section-content');

            function showSection(hash) {
                const targetHash = hash || `#${sectionsData[0].id}`;
                sections.forEach(section => section.classList.toggle('active', `#${section.id}` === targetHash));
                navLinks.forEach(link => link.classList.toggle('active', link.getAttribute('href') === targetHash));
            }

            navMenu.addEventListener('click', function(e) {
                const link = e.target.closest('.nav-link');
                if (link) {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    history.pushState(null, null, targetId);
                    showSection(targetId);
                    window.scrollTo(0, 0);
                }
            });

            // --- LÓGICA DE COMPLETITUD Y PROGRESO ---
            function checkCompletion() {
                let completedSections = 0;
                sectionsData.forEach(data => {
                    const sectionInputs = document.querySelectorAll(`.autosave-input[data-section="${data.id}"]`);
                    let isComplete = Array.from(sectionInputs).some(input => (input.type === 'checkbox' || input.type === 'radio') ? input.checked : input.value.trim() !== '');
                    
                    const navLink = document.querySelector(`.nav-link[href="#${data.id}"]`);
                    const icon = navLink.querySelector('.completion-icon');
                    if (isComplete) {
                        completedSections++;
                        icon.classList.remove('text-gray-400');
                        icon.classList.add('text-green-500');
                    } else {
                        icon.classList.add('text-gray-400');
                        icon.classList.remove('text-green-500');
                    }
                });
                const progress = (completedSections / sectionsData.length) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;
            }

            // --- AUTOSAVE ---
            function loadSavedData() {
                document.querySelectorAll('.autosave-input').forEach(input => {
                    const savedValue = localStorage.getItem('sesionb_' + input.dataset.id);
                    if (savedValue) {
                        if (input.type === 'radio' || input.type === 'checkbox') {
                            if (input.value === savedValue || (input.type === 'checkbox' && savedValue === 'true')) input.checked = true;
                        } else {
                            input.value = savedValue;
                        }
                    }
                });
                checkCompletion();
            }

            mainContent.addEventListener('input', function(e) {
                 if (e.target.classList.contains('autosave-input')) {
                    const input = e.target;
                    const valueToSave = (input.type === 'checkbox') ? input.checked : input.value;
                    localStorage.setItem('sesionb_' + input.dataset.id, valueToSave);
                    checkCompletion();
                 }
            });
            mainContent.addEventListener('change', function(e) {
                 if (e.target.classList.contains('autosave-input') && (e.target.type === 'radio' || e.target.tagName === 'SELECT')) {
                    const input = e.target;
                    localStorage.setItem('sesionb_' + input.dataset.id, input.value);
                    checkCompletion();
                 }
            });

            // --- EXPORTAR A PDF ---
            document.getElementById('export-pdf').addEventListener('click', function() {
                const { jsPDF } = window.jspdf;
                const loadingIndicator = document.getElementById('loading');
                loadingIndicator.style.display = 'block';
                
                const currentHash = window.location.hash;
                sections.forEach(s => s.classList.add('active'));
                
                html2canvas(mainContent, { scale: 2, useCORS: true }).then(canvas => {
                    showSection(currentHash);
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = imgWidth / imgHeight;
                    let imgHeightOnPdf = pdfWidth / ratio;
                    let heightLeft = imgHeightOnPdf;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeightOnPdf);
                    heightLeft -= pdfHeight;

                    while (heightLeft > 0) {
                        position -= pdfHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeightOnPdf);
                        heightLeft -= pdfHeight;
                    }

                    const participantName = localStorage.getItem('sesionb_nombre_participante') || 'participante';
                    pdf.save(`Workbook_SesionB_${participantName}.pdf`);
                    loadingIndicator.style.display = 'none';
                }).catch(err => {
                    console.error("Error al generar el PDF:", err);
                    loadingIndicator.style.display = 'none';
                    showSection(currentHash);
                });
            });

            // --- INICIALIZACIÓN FINAL ---
            showSection(window.location.hash);
            loadSavedData();
        });
    </script>

</body>
</html>
